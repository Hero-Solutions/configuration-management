---
- name: Determine distribution codename
  set_fact:
    distro_codename: "{{ ansible_facts.lsb.codename | default(ansible_facts.os_release.codename, true) }}"

- name: Add Sury PHP signing key for Debian
  apt_key:
    url: "https://packages.sury.org/php/apt.gpg"
    state: present
  when: ansible_facts.distribution == 'Debian'

- name: Add Sury PHP APT repository for Debian
  apt_repository:
    repo: "deb https://packages.sury.org/php/ {{ distro_codename }} main"
    state: present
  when: ansible_facts.distribution == 'Debian'

- name: Add Ondrej PHP PPA for Ubuntu
  apt_repository:
    repo: "ppa:ondrej/php"
    state: present
  when: ansible_facts.distribution == 'Ubuntu'
